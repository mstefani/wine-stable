The Wine maintenance release 5.0.4 is now available.

What's new in this release (see below for details):
  - Various bug fixes

The source is available from the following locations:

  https://dl.winehq.org/wine/source/5.0/wine-5.0.4.tar.xz
  http://mirrors.ibiblio.org/wine/source/5.0/wine-5.0.4.tar.xz

Binary packages for various distributions will be available from:

  https://www.winehq.org/download

You will find documentation on https://www.winehq.org/documentation

You can also get the current source directly from the git
repository. Check https://www.winehq.org/git for details.

Wine is available thanks to the work of many people. See the file
AUTHORS in the distribution for the complete list.

----------------------------------------------------------------

Bugs fixed in 5.0.4 (total 67):

  18670  QIP Infium 2.0 build 9030 crashes on exit (needs a proper implementation of WSACleanup)
  21150  Memorex exPressit Label Design Studio 4.x crashes when creating a new project (ieframe 'IOleObject::Advise' is a stub)
  22616  Multiple applications need msvcirt.dll.??0ifstream@@QAE@PBDHH@Z (Merriam-Webster Dictionary, Power Tab Editor, gmax 1.2, GradeBook for Windows, Microsoft Reader)
  22749  Hard link creation from a Finddupe-generated batch file fails ('fsutil.exe' needs to support 'hardlink create' command)
  28332  Wazzal 1.2 (2002 release) crashes after clicking 'Play'
  30014  Multiple programs require msvcirt.dll.??0ifstream@@QAE@XZ (Wouxun KG-UV2D, Charon, Cricket 2002, Mastercook 15, GraphCalc)
  32613  Tom Clancy's Rainbow Six: Lockdown crashes after the intro videos (needs DxDiag_SoundDevices device child nodes present)
  32877  Gnomoria Demo crashes on launch.
  33996  Multiple installers fail in VBScript custom actions due to missing support of Properties with Parameters (IncrediMail, LabChart Reader 8, Toad for MySQL Freeware 7.x)
  34770  Some WMI applications fail when incorrectly passing WBEM_MASK_CONDITION_ORIGIN to IWbemClassObject::GetNames method
  35744  LabChart Reader 8 installer ends prematurely (VBScript support for class default sub missing)
  35782  Tic Tac Toe Game (vbscript) cannot be played (colon used in for loop for placing multiple statements on the same line)
  38014  CCCP Insurgent v2007-01-01 crashes when querying system information via DxDiag
  38964  widl: inconsistent null pointer checks in typelib writer
  39731  Assassin's Creed IV Black Flag crashes
  40430  Multiple NVIDIA installers abort due to failure to process xml config (PhysX 9.x, GeForce Now, GeForce Experience 3.x, RTX Voice)
  42731  stack overflow when .bat script variable has more than 256 characters
  44061  Destiny 2 crashes on launch (needs non-zero TimeDateStamp field in PE file header)
  44367  Multiple applications need d2d FillEllipse/DrawEllipse implementation (OP-X PRO II VST)
  44502  Epic Games Launcher (Fortnight 7.x) reports 'Error: Initialization failed while advising the language notification sink to the TSF source.  (0x80004001)' (unsupported ITfActiveLanguageProfileNotifySink)
  45400  eden* (VN) some font characters display with the wrong glyph (capitals/spaces)
  45797  NVIDIA GeForce Experience 3.x installer fails due to 'mshtml.OleObject_{Get,Set}Extent' stubs
  46967  GOG Galaxy doesn't run in virtual desktop
  47570  Builtin Split function not implemented (needed by FotoBizX Installer)
  48396  'cmd.exe /c move file1 file2' doesn't respect non-interactive mode, causing prompt for overwrite if destination file exists
  48397  'cmd.exe /c move file1 file2' doesn't overwrite existing destination file in non-interactive mode
  48529  Avencast: Rise of the Mage fails to launch
  48545  SDL GameControllerAddMapping registry keys do not work
  48860  RegiStax 6: mouse does not work in open file dialog
  48870  Aldi (Buhl) Steuer 2019/2020 installer crashes
  49143  RTF Editor does not support cyrillic letters using MS Sans Serif Font
  49172  Always true condition `code > 0xffff` in vbscript/global.c
  49309  vbscript:run test fails in Japanese locale
  49314  Wine segfaults with too many command-line arguments
  49335  Dolphin EasyReader for Windows 6.04 (TTS app) crashes after completing startup wizard (needs IMarkupServices::CreateMarkupPointer method implementation)
  49449  Terraria Mobile Server (.NET 4.x) crashes with System.NotImplementedException NATUPNPLib.IUPnPNAT.get_StaticPortMappingCollection()
  49450  Adobe Shockwave Player 11.x plugin installer fails with jscript:cc_parser_parse '&&' expression not implemented
  49575  Delphi applications no longer show their main window in the WM's taskbar
  49591  Multiple GOG installers display the error message "Out of Global Vars range"
  49643  Calling ClipCursor too frequently can cause stack overflow in foreground window thread.
  49719  The Bat! v9.2.2.3: The 32bit version and the 64bit version crashed after startup
  49728  Appear (a 4K rendering demo) crashes on unimplemented function user32.dll.SetWindowFullScreenState
  49738  "warning: implicit declaration of function ‘strtoumax’" when compiling PuTTY with Winelib
  49774  macDriver no longer functions within macOS VM
  49805  Pyxel Edit crashes when clicking the "File" dropdown option.
  49806  WIDL doesn't tolerate attribute [hidden] within enums.
  49808  Stellaris loads very slowly
  49811  cmd /c "cd "directory"&&"somecommand.exe"" tries to cd to "directory"&&"somecommand.exe"
  49820  VBScript fails to parse decimal literals between -1 and 1 without 0 in front
  49821  Seismobuild crashes at start
  49850  No One Lives Forever crashes due to GetMotif stub in dmstyle
  49857  NCLauncher2: Crypto error on a successful login
  49900  Go programs built using go-winio crash on unimplemented function ntdll.dll.RtlDefaultNpAcl
  49909  Win Toolkit v.1.4.37.20 (.NET 3.5 app) crashes with wine-mono
  49924  IP address control does not focus its fields on focus change
  49982  A '(call )' line does not reset %ERRORLEVEL% to 0
  50016  PS Remote Play can't install: "To use PS Remote Play, update your PC's OS to the latest version, and then install the Media Feature Pack from Microsoft."
  50031  The Foundation Game crashes with bundled ucrtbase
  50038  IWbemClassObject::Get method with wszName = NULL crashes inside wbemprox
  50049  Fallout 76 opens black screen then crashes on start
  50094  Rockstar Games Launcher installer hyperlinks don't work
  50116  ODBC applications fail to create/configure system DSNs with builtin 'odbccp32' (SQLConfigDataSource must remap ODBC_xxx_SYS_DSN values for ConfigDSN)
  50126  Writing VT_UI8 property type to a stream is not currently supported
  50153  HID doesn't work on macOS Catalina and Big Sur unless "Input Monitoring" permission is granted
  50160  VstHost crashes on unimplemented function avrt.dll.AvSetMmMaxThreadCharacteristicsA
  50179  Future Pinball: parse_hex_literal invalid literal
  50373  Touhou Shinpiroku trial terminates immediately

----------------------------------------------------------------

Changes since 5.0.3:

Aaron Hill (1):
      cmd: Set errorlevel to 0 when 'call' is invoked with an empty string.

Akihiro Sagawa (4):
      vbscript: Support non-Latin 1 characters in Asc.
      kernelbase: Improve Get{, Dynamic}TimeZoneInformation() performance.
      kernelbase: Fix copy and paste error.
      d3dx9: Avoid closing invalid handles.

Alex Henrie (1):
      user32: Comment out SetWindowFullScreenState.

Alexandre Abgrall (1):
      msxml3: Fix value of 'fetched' in IEnumVARIANT::Next() for IXMLDOMSelection.

Alexandre Julliard (3):
      winebuild: Set PE timestamps to a hash of the file name.
      winex11: Don't delay mapping 0-sized layered windows.
      ntdll: Avoid overflowing the command line buffer.

Alistair Leslie-Hughes (3):
      ws2_32: Correct returned error code for an invalid socket.
      msado15: Implement _Command get/putref ActiveConnection.
      msctf: Accept ITfActiveLanguageProfileNotifySink in ThreadMgr AdviseSink.

Arkadiusz Hiler (4):
      msvcirt: Implement most of ifstream.
      gdi32: Limit GetGlyphOutlineW(uChar) to a WORD.
      msvcirt: Implement _mtlock() and _mtunlock().
      user32: Fix WM_DEVICECHANGE handling.

Biswapriyo Nath (1):
      ntdll: Add RtlDefaultNpAcl stub.

Brendan Shanks (4):
      winemac.drv: Don't fail GPU detection if some IOKit properties are missing.
      winebrowser: Prefix an invalid URL with 'http://' before opening with a browser.
      wine.inf: Add UrlAssociations for FTP/HTTP/HTTPS.
      winebus.sys: Open IOHID devices individually to fix macOS Catalina and Big Sur.

Christian Costa (1):
      d3dx9: Ignore vertices reordering for D3DXMESHOPT_ATTRSORT in OptimizeInPlace().

Damjan Jovanovic (1):
      cmd.exe: Increase size of WCMD_HandleTildeModifiers() buffers to MAXSTRING.

Dmitry Timoshkov (2):
      ieframe: Implement IOleObject::Advise().
      usp10: Don't specify ETO_GLYPH_INDEX for bitmap fonts.

Esme Povirk (2):
      dism: Add version resource.
      mscoree: Use builtin XNA implementation by default.

Fabian Maurer (1):
      user32/menu: Store application defined value as pointer.

Francesco Noferi (1):
      cmd.exe: Fix parsing of && between quotes.

Gijs Vermeulen (6):
      mshtml: Implement IOleObject::[Get|Set]Extent.
      msvcr120: Add [_]strtoimax[_l] and [_]strtoumax[_l].
      quartz: Return E_INVALIDARG when cursor is NULL in IEnumFilters::Skip().
      quartz: Only return S_FALSE in IEnumFilters::Skip() if count goes past the end of the sequence.
      wbemprox: Accept 0 and WBEM_FLAG_ALWAYS | WBEM_MASK_CONDITION_ORIGIN as flags in IWbemClassObject::GetNames().
      avrt: Add AvSetMmMaxThreadCharacteristicsA/W stub.

Giovanni Mascellani (1):
      d2d1: Implement ellipse drawing.

Haidong Yu (2):
      inetcpl.cpl: Fix memory leak in security_on_initdialog.
      ieframe: Fix memory leak in PersistFile_Save.

Hans Leidekker (6):
      crypt32: Add support for CRYPT_MACHINE_KEYSET in PFXImportCertStore.
      wbemprox: Also return system properties from IWbemClassObject::GetNames.
      odbccp32: Map system DSN requests to user DSN requests in SQLConfigDataSource.
      winebus.sys: Fix registry access rights for SDL controller mapping.
      msado15: Avoid a crash with tracing on.
      winhttp: Avoid a crash when the connection is closed while handling a redirect.

Hirofumi Katayama (1):
      comctl32/ipaddress: Focus first field on WM_SETFOCUS.

Huw D. M. Davies (2):
      user32: Use a default name for winstations created or opened with no name.
      qcap: Avoid unused variable warning if v4l is absent.

Jacek Caban (4):
      mshtml.idl: Add missing MoveUnitBounded to IMarkupPointer2.
      mshtml: Add IMarkupServices::CreateMarkupPointer implementation.
      vbscript: Overflow hex literals in 16-bit range.
      vbscript: Don't convert hex literals ending with '&' to short in parse_hex_literal.

Jan Sikorski (1):
      dbghelp: Avoid forwarded exports.

Ken Thomases (1):
      mountmgr: Avoid operating on a null CFStringRef, which would crash.

Louis Lenders (1):
      explorerframe: Return S_OK in ITaskbarList::RegisterTab.

Michael Müller (4):
      fsutil: Print out usage message.
      fsutil: Add support for creating hardlinks.
      dxdiagn: Enumerate DirectSound devices and add some basic properties.
      dxdiagn: Calling GetChildContainer with an empty string on a leaf container returns the object itself.

Michael Stefaniuc (1):
      dxdiagn/tests: Use wide-char string literals.

Myah Caron (7):
      cmd.exe: Fix /Y flag for move builtin.
      cmd.exe: Don't prompt for move when non-interactive.
      include: Add IShellLinkDual interface.
      shell32: Add ShellLinkObject stubs.
      shell32: Implement ShellLinkObject::get_Path.
      dmstyle: Return S_FALSE for IDirectMusicStyle8::GetMotif.
      dmband: Avoid cloning stream in parse_bands_list.

Nikolay Sivov (4):
      widl: Add null source pointer check for typelib writer.
      widl: Enable [hidden] attribute for enums.
      comctl32/ipaddress: Select field contents on IPM_SETFOCUS.
      ole32/propstorage: Handle VT_I8/VT_UI8 when serializing properties.

Paul Gofman (1):
      d3d11: Avoid crash in _CopySubresourceRegion[1]() on NULL resources.

Piotr Caban (2):
      msvcrt: Don't write Unicode BOM if file is not empty in _wsopen_dispatch.
      msvcrt: Implement opening Unicode files with no BOM in _wsopen_dispatch.

Robert Wilhelm (13):
      vbscript: Implement Split.
      vbscript: Colon used in for loop.
      vbscript: Parse decimal literals between -1 and 1 without 0 in front.
      vbscript: Fix handling zero and negative number arguments in err.raise.
      vbscript: Fix vanishing statements.
      vbscript: Add is_default flag to function_decl_t.
      vbscript: Support class default sub.
      jscript: Cc_parser_parse implement '&&' expression.
      vbscript: Allow keywords to be used as function name.
      vbscript: Allow keywords to be used as property name.
      vbscript: Support properties with parameters.
      vbscript: Support property set with parameters.
      vbscript: Remove overzealous check in parse_hex_literal.

Rémi Bernon (5):
      winex11.drv: Don't wait for the desktop thread to store clipping window.
      user32: Return TRUE from ShowWindow(SW_SHOW) if already visible.
      wbemprox: Report 4095MiB video memory if it overflows.
      mscoree/tests: Test invalid assembly paths in registry.
      mscoree: Fallback to assembly name if codebase path is invalid.

Sven Baars (1):
      shell32: Fix a leak on error path (Coverity).

Vijay Kiran Kamuju (2):
      include: Add IMarkupServices2, IMarkupContainer2 and IMarkupPointer2 related interfaces.
      hnetcfg: Return S_OK in get_StaticPortMappingCollection.

Yongjie Yao (1):
      msxml3: Fix a memory leak (Valgrind).

Zebediah Figura (5):
      ws2_32: Keep a list of open sockets.
      ws2_32: Close all open sockets in WSACleanup().
      wine.inf: IsInstalled is a DWORD value.
      user32/tests: Add some tests for release of capture via modal dialogs.
      user32: Send WM_CANCELMODE to the current capture window after initializing a modal dialog.

--
Michael Stefaniuc
mstefani@winehq.org
